<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lauren, Olya, Matt, Cj, &amp; Keyanna" />

<meta name="date" content="2019-12-05" />

<title>Stop! You Are Being Frisked!</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.9.1/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.49.4/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.49.4/plotly-latest.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="flexdashboard.html">Demographics Analysis</a>
</li>
<li>
  <a href="project_report.html">Project Report</a>
</li>
<li>
  <a href="https://group-13-final-proj.shinyapps.io/shiny_map/">Map</a>
</li>
<li>
  <a>
    <span class="fa fa-youtube fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="mailto:&lt;mp3745@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/mparker7/group_13_final_proj/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Stop! You Are Being Frisked!</h1>
<h4 class="author">Lauren, Olya, Matt, Cj, &amp; Keyanna</h4>
<h4 class="date">December 5, 2019</h4>

</div>


<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>Terry Stop is a crime-preventing program that has been used by the police around the country for more than 40 years. In New York City this program is known as stop-and-frisk and consists of possible temporary detention and questioning of an individual with possible searching for weapons or other contraband. During Michael Bloomberg’s tenure as mayor of the City of New York, this program became increasingly aggressive and subsequently turned out to be the hot topic of discussion throughout the nation. In 2011 stop-and-frisk reached almost 700,000 stops. During the same year the New York Civil Liberties Union successfully sued the New York Police Department and forced it to regularly report to the public all stop-and-frisk related activities. From the obtained data, it was concluded that majority of stopped individuals were black and Hispanic men. Bloomberg and then NYC Police Commissioner Raymond W. Kelly, were accused of racial profiling.</p>
<p>Stop-and-frisk has been proven to be unsuccessful in identifying criminals and recovering illegal weapons. For years Bloomberg argued that there is a causal relationship between stop-and-frisk and crime rates in NYC, in order to rally support for the program. This assumption has been proven to be incorrect by the fact that even after the program was scaled back, crime rates continued to decline in NYC. During mayoral election campaign in 2013, public pressure forced Bloomberg to cut back on this practice.</p>
<p>After Bill de Blasio won mayoral election in 2013, he continued to downsize the program. In 2016 the number of stops were less than 2% in comparison to that of 2011, when the stops reached its peak. In spite of expectations, crime prevalence continued to decline even after the program was decreased by 98%.</p>
</div>
<div id="related-work" class="section level1">
<h1>Related Work</h1>
<p>New York Civil Liberties Union report <a href="https://www.nyclu.org/en/publications/stop-and-frisk-de-blasio-era-2019">Stop-and-Frisk in the de Blasio era</a>.</p>
</div>
<div id="initial-questions" class="section level1">
<h1>Initial Questions</h1>
<p>We are interested in determining if there is a predictive nature to this dataset. We also want to describe the scope of the dataset through visualizations of the different demographics present and create a map of stops across the five boroughs. Specifically, we strive to answer the following questions:</p>
<ul>
<li>What is the distribution of demographics in the dataset?</li>
<li>After being stopped, can demographics, characteristics, and location of stop predict whether or not the individual will be frisked or arrested?</li>
<li>What are the trends in stops across different areas of New York City?</li>
</ul>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>Our dataset is from the New York Police Department and was obtained through the NYC Open Data resource. It contains data from 12,404 stops that occurred during 2016. The original dataset contained 112 variables, however to narrow our focus, the dataset was reduced down to 45 categorical, binary, and numerical variables that describe each stop and are relevant to the questions at hand. The data cleaning and tidying process recoded variables, implemented understandable variable names, and converted categorical variables to factors and binary variables into ‘0’ and ‘1’ within R. The outcome variables that we are interested in building models for are FRISKED and ARST_MADE. These variables are binary in nature and describe whether the stopped individual was frisked and/or arrested.</p>
</div>
<div id="exploratory-analysis" class="section level1">
<h1>Exploratory Analysis</h1>
<div id="loading-and-tidying-the-data" class="section level3">
<h3>Loading and tidying the data</h3>
<p>The data used in our analysis was read in from the NYPD portion of nyc.gov data. After reading in the data, we selected a subset of variables that we would use for further analysis. Then initial cleaning steps converted variables to their appropriate data type and renamed variables for clarity. We decided to convert age = 1, weight = 999, and weight = 1 to NA because these values are highly unlikely and may have been entered in error or used to represent missing values. To obtain a dataset that could be used in LASSO and modeling logistic regression, several categorical variables with levels that had representation of less than 2% were regrouped into ‘other’ to ensure that both the testing and training dataset have individuals represented from all categorical levels. This included regrouping levels within the variables build, race, hair color, and eye color.</p>
<pre class="r"><code># Read in data
stop_frisk_df = 
  # Read in data from internet
  GET(&quot;https://www1.nyc.gov/assets/nypd/downloads/excel/analysis_and_planning/stop-question-frisk/sqf-2016.csv&quot;) %&gt;% 
  content(&quot;parsed&quot;) %&gt;% 
  
  # Clean and fix names of columns
  janitor::clean_names() %&gt;% 
  rename(
    precinct = pct,
    date_stop = datestop,
    time_stop = timestop,
    stop_in_out = inout,
    obs_time_min = perobs,
    stop_time_min = perstop,
    arst_made = arstmade,
    off_in_unif = offunif,
    hair_col = haircolr,
    eye_col = eyecolor,
    other_feature = othfeatr,
    boro = city
  )  %&gt;% 
  mutate(
    # Change values to missing
    weight = ifelse(weight == 999, NA, weight),
    age = ifelse(age == 1, NA, age),
    weight = ifelse(weight == 1, NA, weight),
    # Combine height columns
    height_inch = ht_feet * 12 + ht_inch,
    # Convert date to proper format
    date_stop = mdy(date_stop),
    # Convert time to proper format
    time_stop = hm(time_stop / 100),
    # Recode to be more informative
    stop_in_out = recode(stop_in_out, &quot;I&quot; = &quot;inside&quot;, &quot;O&quot; = &quot;outside&quot;),
    race = recode(
      race, 
      &quot;A&quot; = &quot;other&quot;, 
      &quot;B&quot; = &quot;black&quot;, 
      &quot;I&quot; = &quot;other&quot;,
      &quot;P&quot; = &quot;black-hispanic&quot;,
      &quot;Q&quot; = &quot;white-hispanic&quot;,
      &quot;W&quot; = &quot;white&quot;,
      &quot;U&quot; = &quot;other&quot;,
      &quot;Z&quot; = &quot;other&quot;
    ),
    hair_col = recode(
      hair_col,
      &quot;BA&quot; = &quot;bald&quot;,
      &quot;BK&quot; = &quot;black&quot;,
      &quot;BL&quot; = &quot;blond&quot;,
      &quot;BR&quot; = &quot;brown&quot;,
      &quot;DY&quot; = &quot;other&quot;,
      &quot;FR&quot; = &quot;other&quot;,
      &quot;GY&quot; = &quot;other&quot;,
      &quot;RA&quot; = &quot;other&quot;,
      &quot;SN&quot; = &quot;other&quot;,
      &quot;SP&quot; = &quot;other&quot;,
      &quot;WH&quot; = &quot;other&quot;,
      &quot;XX&quot; = &quot;other&quot;,
      &quot;ZZ&quot; = &quot;other&quot;,
    ),
    eye_col = recode(
      eye_col,
      &quot;BK&quot; = &quot;black&quot;,
      &quot;BL&quot; = &quot;blue&quot;,
      &quot;BR&quot; = &quot;brown&quot;,
      &quot;DF&quot; = &quot;other&quot;,
      &quot;GR&quot; = &quot;other&quot;,
      &quot;GY&quot; = &quot;other&quot;,
      &quot;HA&quot; = &quot;other&quot;,
      &quot;MA&quot; = &quot;other&quot;,
      &quot;PK&quot; = &quot;other&quot;,
      &quot;VI&quot; = &quot;other&quot;,
      &quot;XX&quot; = &quot;other&quot;,
      &quot;Z&quot; = &quot;other&quot;,      
    ),
    build = recode(
      build,
      &quot;H&quot; = &quot;heavy&quot;,
      &quot;M&quot; = &quot;medium&quot;,
      &quot;T&quot; = &quot;thin&quot;,
      &quot;U&quot; = &quot;other&quot;,
      &quot;Z&quot; = &quot;unknown&quot;
    ),
    # change boro columns to lowercase for consistency
    boro = tolower(boro),
    # change character datatypes to numeric
    age = as.numeric(age),
    obs_time_min = as.numeric(obs_time_min),
    stop_time_min = as.numeric(stop_time_min)
  )  %&gt;% 
  # select columns for further analysis
  select(precinct, date_stop, time_stop, stop_in_out, obs_time_min, stop_time_min, arst_made, off_in_unif, frisked, 
         searched, rf_vcrim, rf_othsw, rf_attir:ac_evasv, cs_furtv:cs_other, rf_knowl, sb_hdobj:sb_admis, rf_furt, 
         rf_bulg, sex, race, age, height_inch, weight:build, boro, xcoord, ycoord) %&gt;% 
  # change all columns that have Y/N to 1/0
  mutate_at(vars(arst_made:rf_bulg), funs(recode(., &quot;Y&quot; = &quot;1&quot;, &quot;N&quot; = &quot;0&quot;))) %&gt;% 
  # change binary columns to numeric instead of character
  mutate_at(vars(arst_made:rf_bulg), funs(as.numeric(.))) %&gt;% 
  # converts all character variables to factors (this does the same as the for loop)
  mutate_if(is.character, as.factor) %&gt;% 
  # remove the single row of NAs
  filter(
    !is.na(build)
  )</code></pre>
</div>
<div id="demographics" class="section level3">
<h3>Demographics</h3>
<p>The 12404 reported stops in 2016 were spread unevenly amongst the different races with black being the leading race over 50%, white-hispanic about 20%, and white, other and black-hispanic being under 10%. Of those 12404 reported stops 7939 individuals were frisked, and 2643 individuals were arrested. The most frequently frisked and arrested race was black. Of the 12404 reported stops, 11450 individuals were male, 896 female, and 58 unknown.</p>
<p>The age of the stopped individuals ranges from 2 to 99, with equal age distribution among the sexes. Over 50% of stopped individuals were between 18 and 30 years old. Most stops occurred in Brooklyn (30%) and Queens (26%). The 4 leading reasons for stops were identified to be “fits a relevant description”, “furtive movements”, “other” and “casing a victim or location.”</p>
<pre class="r"><code># Percent innocent for each race category
percent_innocent = function(x) {
  stop_frisk_df %&gt;% 
  filter(
         #age &lt; 18,
         race == x) %&gt;% 
  group_by(race, arst_made) %&gt;% 
  count() %&gt;% 
  pivot_wider(
    names_from = arst_made,
    values_from = n) %&gt;% 
  rename(
    innocent = `0`,
    arrested = `1`) %&gt;% 
  mutate(
    percentage = (innocent/(innocent + arrested)) *100)
}

output = map_df(stop_frisk_df$race, percent_innocent) %&gt;% 
  distinct(race, percentage)

output %&gt;% 
  ungroup(race) %&gt;% 
  mutate(
    race = fct_relevel(race, c(&quot;white&quot;, &quot;black&quot;, &quot;other&quot;, &quot;white-hispanic&quot;)),
    race = recode(race, 
                  &quot;white&quot; = &quot;White&quot;,
                  &quot;black&quot; = &quot;Black&quot;,
                  &quot;other&quot; = &quot;Other&quot;,
                  &quot;white-hispanic&quot; = &quot;White-Hispanic&quot;,
                  &quot;black-hispanic&quot; = &quot;Black-Hispanic&quot;)
    ) %&gt;% 
plot_ly(x = ~race, y = ~percentage, type = &quot;bar&quot;, color = ~race) %&gt;% 
  layout(
    title = &#39;Percent innocent Minors among each race category&#39;,
    xaxis = list(
      type = &#39;category&#39;,
      title  = &#39;Race&#39;), 
    yaxis = list(
      title = &#39;Percent innocent, %&#39;,
      range = c(0, 100)
    ) 
  )</code></pre>
</div>
<div id="logistic-regression-analysis" class="section level3">
<h3>Logistic Regression Analysis</h3>
<p><strong>Goal:</strong> To select for models that will best answer the following questions:</p>
<ul>
<li>Among those who were stopped, can we model demographics, location of stop, and reasons for stopping to predict whether the person will be frisked or not?</li>
<li>Among those who were stopped, can we model demographics, location of stop, and reasons for stopping to predict whether the person will be arrested or not?</li>
</ul>
<p><strong>Methods:</strong></p>
<p>Only variables that preceded the individual being stopped were used in logistic regression models. Thus, all variables that described reason for frisk or reason for search were omitted. We focused on the characteristics, demographics, location, and reasons for stopping in the model. To build models for ARST_MADE and FRISKED, we evaluated GVIF to verify that there is no multicollinearity present and removed any variables suspected of having high collinearity. Model selection was based on consideration of AIC values, inflated standard errors, and p values. When AIC values did not change between models, ANOVA was used to compare similar models to determine whether the larger or smaller model was significantly better. Above all, we wanted to keep the concept of parsimony in mind when selecting models and minimize overfitting. Finally, the models were evaluated using a training and testing dataset to assess the predictive ability of the model using Area Under the Curve (AUC).</p>
<p><strong>FRISKED Model:</strong></p>
<pre class="r"><code>set.seed(1)
train = sample_frac(stop_frisk_df, size = 0.8)
test = anti_join(stop_frisk_df, train)

model_1 = glm(frisked ~ sex + race + age + height_inch + weight + hair_col + eye_col + boro + build + stop_in_out + precinct + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_lkout + cs_cloth + cs_drgtr + cs_furtv + cs_vcrim+ cs_bulge + cs_other, family = binomial, data = train)

car::vif(model_1)
# Based on the GVIF, we will remove boro

model_2 = glm(frisked ~ sex + race + age + height_inch + weight + hair_col + eye_col + build + stop_in_out + precinct + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_lkout + cs_cloth + cs_drgtr + cs_furtv + cs_vcrim+ cs_bulge + cs_other, family = binomial, data = train)

car::vif(model_2)
# no more collinearity problems

summary(model_2)
# Remove hair and eye color because all categories within them are highly unsignificant, cs_drgtr, cs_lkout

model_3 = glm(frisked ~ sex + race + age + height_inch + weight + build + stop_in_out + precinct + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_cloth + cs_furtv + cs_vcrim+ cs_bulge + cs_other, family = binomial, data = train, na.action = na.omit)

summary(model_3)
# remove weight, cs_cloth, cs_objcs
model_4 = glm(frisked ~ sex + race + age + height_inch + build + stop_in_out + precinct + off_in_unif + cs_descr + cs_casng + cs_furtv + cs_vcrim+ cs_bulge + cs_other, family = binomial, data = train)

summary(model_4)

log_pred = predict(model_4, newdata = test, type = &quot;response&quot;)

log_pred = ifelse(log_pred &gt; 0.5, 1, 0)

library(ROCR)
library(Metrics)

pr = prediction(log_pred, test$frisked)
perf = performance(pr, measure = &quot;tpr&quot;, x.measure = &quot;fpr&quot;)
auc(test$frisked, log_pred)

log_pred = ifelse(log_pred == 1, &quot;Predicted Frisk&quot;, &quot;Predicted No Frisk&quot;)</code></pre>
<p>Utilizing the methods above, the logistic regression model that was determined to have the best predictive ability included the variables: sex, race, age, height, build, stop inside/outside, officer in uniform, precinct, reason for stop - fits a relevant description, casing a victim or location, furtive movements, violent crime suspected, suspicious bulge, and other. With this model, the predictive power was 0.564. This value is only slightly better than guessing (0.50).</p>
<p><strong>FRISKED AUC Curve</strong></p>
<pre class="r"><code>plot(perf)</code></pre>
<p><img src="project_report_files/figure-html/unnamed-chunk-4-1.png" width="90%" /></p>
<p><strong>Confusion Matrix: Predicted Frisked Status vs True Frisked Status</strong></p>
<pre class="r"><code>#confusion matrix
table(pred = log_pred, true = test$frisked) %&gt;% knitr::kable(col.names = c(&quot;No Frisk&quot;, &quot;Frisk&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">No Frisk</th>
<th align="right">Frisk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Predicted Frisk</td>
<td align="right">634</td>
<td align="right">1395</td>
</tr>
<tr class="even">
<td>Predicted No Frisk</td>
<td align="right">224</td>
<td align="right">193</td>
</tr>
</tbody>
</table>
<p><strong>ARST_MADE Model:</strong></p>
<pre class="r"><code>model_5 = glm(arst_made ~ sex + race + age + height_inch + weight + hair_col + eye_col + boro + build + stop_in_out + precinct + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_lkout + cs_cloth + cs_drgtr + cs_furtv + cs_vcrim+ cs_bulge + cs_other, data = train)

summary(model_5)

car::vif(model_5)

# remove eye color and build, remove boro due to correlation
model_6 = glm(arst_made ~ sex + race + age + height_inch + weight + hair_col + stop_in_out + precinct + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_lkout + cs_cloth + cs_drgtr + cs_furtv + cs_vcrim+ cs_bulge + cs_other, family = binomial, data = train)

summary(model_6)

# remove height, precinct, age
model_7 = glm(arst_made ~ sex + race + weight + hair_col + stop_in_out + age + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_lkout + cs_cloth + cs_drgtr + cs_furtv + cs_vcrim+ cs_bulge + cs_other, family = binomial, data = train)

summary(model_7)

# remove insignificant reasons for stop cs_furtv, cs_vcrim, cs_other, cx_bulge, cs_furtv, cs_lkout, and sex
model_8 = glm(arst_made ~ race + weight + hair_col + stop_in_out + off_in_unif + cs_objcs + cs_descr + cs_casng + cs_cloth + cs_drgtr, family = binomial, data = train)

summary(model_8)

log_pred = predict(model_8, newdata = test, type = &quot;response&quot;)

log_pred = ifelse(log_pred &gt; 0.5, 1, 0)

pr = prediction(log_pred, test$arst_made)
perf = performance(pr, measure = &quot;tpr&quot;, x.measure = &quot;fpr&quot;)
auc(test$arst_made, log_pred)

log_pred = ifelse(log_pred == 1, &quot;Predicted Arrest&quot;, &quot;Predicted No Arrest&quot;)</code></pre>
<p>The logistic regression model that was determined to have the best predictive ability included the variables: race, weight, hair color, stop inside/outside, whether the officer was in uniform, and five reasons for stop variables. This model only performed slightly better than taking a random guess, with an AUC value of 0.515. Based on the confusion matrix, the model is biased to predicting that the individual will not be arrested.</p>
<p><strong>ARST_MADE AUC Curve</strong></p>
<pre class="r"><code>plot(perf)</code></pre>
<p><img src="project_report_files/figure-html/unnamed-chunk-7-1.png" width="90%" /></p>
<p><strong>Confusion Matrix: Predicted Arrest Status vs True Arrest Status</strong></p>
<pre class="r"><code>table(pred = log_pred, true = test$arst_made) %&gt;% knitr::kable(col.names = c(&quot;No Arrest&quot;, &quot;Arrest&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">No Arrest</th>
<th align="right">Arrest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Predicted Arrest</td>
<td align="right">17</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td>Predicted No Arrest</td>
<td align="right">1907</td>
<td align="right">504</td>
</tr>
</tbody>
</table>
</div>
<div id="lasso-regression" class="section level3">
<h3>LASSO Regression</h3>
<p>LASSO regression was used to determine if machine learning could build a model that can make better predictions. Observations with missing data were removed, testing and training datasets were created, and cross validation was used to select the best model using the LASSO procedure. A matrix dataset was used to create dummy variables for all categorical variables, resulting in 33 variables. The lasso procedure for the FRISKED model kept 16 variables in the model and minimized 17 variables. Some important varialbes that LASSO kept in the model was sex = male, stop inside/outside, and officer in uniform. The AUC value was 0.444, which was less than the value selected from our logistic modeling, and is not a desired value for AUC, falling below 0.50, indicating the model is worse than taking a guess. LASSO regression for the arrest made model selected only 2 of the 33 variables (stop inside/outside and reason for stop: action indicative of drug transaction) and minimized the others to 0. The resulting AUC value was 0.413, which was significantly worse predictions compared to the logistic model from above. This is not surprising given that the model only selected for 2 variables. To develop our confusion matrix, because arrests were a small portion of our dataset, we lowered the “positive” prediction value to 0.3, compared to the traditional 0.5. This yielded a better values in our confusion matrix.</p>
<pre class="r"><code>library(glmnet)

set.seed(1)

# keeping only variables we want to use with frisked logistic prediction
stop_frisk_lasso = stop_frisk_df %&gt;% select(frisked, sex, race, age, height_inch, weight, hair_col, eye_col, build, stop_in_out, precinct, off_in_unif, cs_objcs, cs_descr, cs_casng, cs_lkout, cs_cloth, cs_drgtr, cs_furtv, cs_vcrim, cs_bulge, cs_other) 

stop_frisk_lasso = stop_frisk_lasso[complete.cases(stop_frisk_lasso), ]

# create test and train datasets
train_lasso = sample_frac(stop_frisk_lasso, size = 0.5)
test_lasso = anti_join(stop_frisk_lasso, train_lasso)

# creating x and y
x = model.matrix(frisked ~ ., train_lasso)[,-1]
y = train_lasso$frisked

# lasso fit
lasso_fit = glmnet(x, y, family = &quot;binomial&quot;)

# cross validation
lasso_cv = cv.glmnet(x, y, family = &quot;binomial&quot;, type = &quot;mse&quot;)

lambda_opt = lasso_cv$lambda.min</code></pre>
<pre class="r"><code>#min value of lambda
lambda_min &lt;- lasso_cv$lambda.min
#best value of lambda
lambda_1se &lt;- lasso_cv$lambda.1se
#regression coefficients
coef(lasso_cv, s = lambda_1se)

#get test data
x_test &lt;- model.matrix(frisked ~ ., test_lasso)
x_test = x_test[,-1]

#predict class, type=”class”
lasso_prob &lt;- predict(lasso_cv, newx = x_test, s = lambda_1se, type = &quot;response&quot;)

#translate probabilities to predictions
lasso_predict &lt;- rep(&quot;Pred No Frisk&quot;, nrow(test_lasso))
lasso_predict[lasso_prob &gt; 0.5] &lt;- &quot;Pred Frisk&quot;

auc(test_lasso$frisked, lasso_predict)</code></pre>
<p><strong>Visualizing Best Lambda</strong></p>
<pre class="r"><code># visualizing best lambda
broom::tidy(lasso_fit) %&gt;% 
   select(term, lambda, estimate) %&gt;% 
   complete(term, lambda, fill = list(estimate = 0) ) %&gt;% 
   filter(term != &quot;(Intercept)&quot;) %&gt;% 
   ggplot(aes(x = log(lambda, 10), y = estimate, group = term, color = term)) + 
   geom_path() + 
   geom_vline(xintercept = log(lambda_opt, 10), color = &quot;blue&quot;, size = 1.2) +
   theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="project_report_files/figure-html/unnamed-chunk-11-1.png" width="90%" /></p>
<p><strong>Confusion Matrix: Predicted Frisked Status vs True Frisked Status</strong></p>
<pre class="r"><code>#confusion matrix
table(pred = lasso_predict, true = test_lasso$frisked) %&gt;% knitr::kable(col.names = c(&quot;No Frisk&quot;, &quot;Frisk&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">No Frisk</th>
<th align="right">Frisk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pred Frisk</td>
<td align="right">1823</td>
<td align="right">3629</td>
</tr>
<tr class="even">
<td>Pred No Frisk</td>
<td align="right">399</td>
<td align="right">268</td>
</tr>
</tbody>
</table>
<pre class="r"><code>set.seed(1)

# keeping only variables we want to use with frisked logistic prediction
stop_frisk_lasso_arst = stop_frisk_df %&gt;% select(arst_made, sex, race, age, height_inch, weight, hair_col, eye_col, build, stop_in_out, precinct, off_in_unif, cs_objcs, cs_descr, cs_casng, cs_lkout, cs_cloth, cs_drgtr, cs_furtv, cs_vcrim, cs_bulge, cs_other)

# getting rid of incomplete observations
stop_frisk_lasso_arst = stop_frisk_lasso_arst[complete.cases(stop_frisk_lasso_arst), ]

# create test and train datasets
train_lasso_arst = sample_frac(stop_frisk_lasso_arst, size = 0.5)
test_lasso_arst = anti_join(stop_frisk_lasso_arst, train_lasso_arst)

# creating x and y
x = model.matrix(arst_made ~ ., train_lasso_arst)[,-1]
y = train_lasso_arst$arst_made

# lasso fit
lasso_fit = glmnet(x, y, family = &quot;binomial&quot;)

# cross validation
lasso_cv = cv.glmnet(x, y, family = &quot;binomial&quot;, type = &quot;mse&quot;)

lambda_opt = lasso_cv$lambda.min

# # visualizing best lambda
broom::tidy(lasso_fit) %&gt;% 
   select(term, lambda, estimate) %&gt;% 
   complete(term, lambda, fill = list(estimate = 0) ) %&gt;% 
   filter(term != &quot;(Intercept)&quot;) %&gt;% 
   ggplot(aes(x = log(lambda, 10), y = estimate, group = term, color = term)) + 
   geom_path() + 
   geom_vline(xintercept = log(lambda_opt, 10), color = &quot;blue&quot;, size = 1.2) +
   theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="project_report_files/figure-html/unnamed-chunk-13-1.png" width="90%" /></p>
<pre class="r"><code># coefficients from the optimal model
lasso_fit = glmnet(x, y, lambda = lambda_opt)
lasso_fit %&gt;% broom::tidy()

#min value of lambda
lambda_min &lt;- lasso_cv$lambda.min
#best value of lambda
lambda_1se &lt;- lasso_cv$lambda.1se
#regression coefficients
coef(lasso_cv, s = lambda_1se)

#get test data
x_test &lt;- model.matrix(arst_made ~ ., data = test_lasso_arst)
x_test = x_test[,-1]

#predict class, type=”class”
lasso_prob &lt;- predict(lasso_cv, newx = x_test, s = lambda_1se, type = &quot;response&quot;)

#translate probabilities to predictions
lasso_predict &lt;- rep(&quot;Predicted No Arrest&quot;, nrow(test_lasso_arst))
lasso_predict[lasso_prob &gt; 0.30] &lt;- &quot;Predicted Arrest&quot;

#confusion matrix
table(pred = lasso_predict, true = test_lasso_arst$arst_made)

auc(test_lasso_arst$arst_made, lasso_predict)</code></pre>
<p><strong>Confusion Matrix: Predicted Arrested Status vs True Arrested Status</strong></p>
<pre class="r"><code>#confusion matrix
table(pred = lasso_predict, true = test_lasso_arst$arst_made) %&gt;% knitr::kable(col.names = c(&quot;No Arrest&quot;, &quot;Arrest&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">No Arrest</th>
<th align="right">Arrest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Predicted Arrest</td>
<td align="right">800</td>
<td align="right">467</td>
</tr>
<tr class="even">
<td>Predicted No Arrest</td>
<td align="right">3951</td>
<td align="right">899</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="additional-analysis" class="section level1">
<h1>Additional Analysis</h1>
<div id="minors" class="section level3">
<h3>Minors</h3>
<p>Additional analysis was performed for stopped individuals under age of 18.</p>
<pre class="r"><code>under_18 = stop_frisk_df %&gt;% 
  filter(age &lt; &#39;18&#39;) 

# percent innocent and arrested amoung minors 
under_18 %&gt;% 
  count(arst_made) %&gt;%
  mutate(
    percent = (n / nrow(under_18) * 100)
  ) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<pre class="r"><code>under_18 = stop_frisk_df %&gt;% 
  filter(age &lt; &#39;18&#39;) 

under_18 %&gt;%
  count(race) %&gt;% 
  mutate(
    race = fct_reorder(race, -n)) %&gt;% 
  plot_ly(x = ~ race, y = ~ n, type = &quot;bar&quot;, color = ~ race) %&gt;% 
  layout(
    title = &#39;Minors Stopped by Race&#39;,
    xaxis = list(
      type = &#39;category&#39;,
      title  = &#39;Race&#39;), 
    yaxis = list(
      title = &#39;Count&#39;,
      range = c(0, 1100)
    ) 
  )</code></pre>
<div id="htmlwidget-4725aae44460ee830d1b" style="width:90%;height:576px;" class="plotly html-widget"></div>
<<<<<<< HEAD
<script type="application/json" data-for="htmlwidget-4725aae44460ee830d1b">{"x":{"visdat":{"9d94768652bf":["function () ","plotlyVisDat"]},"cur_data":"9d94768652bf","attrs":{"9d94768652bf":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Minors Stopped by Race","xaxis":{"domain":[0,1],"automargin":true,"type":"category","title":"Race","categoryorder":"array","categoryarray":["black","white-hispanic","black-hispanic","other","white"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Count","range":[0,1100]},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["black"],"y":[1036],"type":"bar","name":"black","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["white-hispanic"],"y":[372],"type":"bar","name":"white-hispanic","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["black-hispanic"],"y":[150],"type":"bar","name":"black-hispanic","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["other"],"y":[138],"type":"bar","name":"other","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["white"],"y":[114],"type":"bar","name":"white","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
=======
<script type="application/json" data-for="htmlwidget-4725aae44460ee830d1b">{"x":{"visdat":{"19093692d99f":["function () ","plotlyVisDat"]},"cur_data":"19093692d99f","attrs":{"19093692d99f":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Minors Stopped by Race","xaxis":{"domain":[0,1],"automargin":true,"type":"category","title":"Race","categoryorder":"array","categoryarray":["black","white-hispanic","black-hispanic","other","white"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Count","range":[0,1100]},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["black"],"y":[1036],"type":"bar","name":"black","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["white-hispanic"],"y":[372],"type":"bar","name":"white-hispanic","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["black-hispanic"],"y":[150],"type":"bar","name":"black-hispanic","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["other"],"y":[138],"type":"bar","name":"other","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["white"],"y":[114],"type":"bar","name":"white","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
>>>>>>> 099bf7ed9e2630663e07393b72c0294ef2d00d6c
<p>14.59% of people who were stopped were underage of 18; out of those 154 were female, 1643 were male and 13 were identified as other. Most minors that were stopped were of race black with a total of 1036 stops.</p>
</div>
<div id="trends-over-time" class="section level3">
<h3>Trends over time</h3>
<pre class="r"><code># Number of stops per day
stops_per_day =
  stop_frisk_df %&gt;% 
  group_by(date_stop) %&gt;% 
  summarize(
    count = n()
  ) %&gt;% 
  ggplot(aes(x = date_stop, y = count)) + 
  geom_point() +
  geom_smooth(se = FALSE) +
  labs(
    title = &quot;Number of stops per day in 2016&quot;,
    x = &quot;Date of stop&quot;,
    y = &quot;Number of stops&quot;
  )

# Number of stops per month (broken down by boro) 
stops_per_month =
  stop_frisk_df %&gt;% 
  mutate(
    month_stop = month(date_stop),
    boro = str_to_title(boro)
  ) %&gt;%   
  group_by(month_stop, boro) %&gt;% 
  summarize(
    count = n()
  ) %&gt;% 
  ggplot(aes(x = month_stop, y = count, color = boro)) + 
  geom_point() +
  geom_line() +
  geom_smooth(se = FALSE, method = &quot;lm&quot;) +
  labs(
    title = &quot;Number of stops per month by borough&quot;,
    x = &quot;Month of stop&quot;,
    y = &quot;Number of stops&quot;,
    color = &quot;Borough&quot;
  ) +
  scale_x_continuous(
    breaks = 1:12,
    labels = c(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;)
  ) +
  theme(
    legend.title = element_text(size = 8),
    legend.text = element_text(size = 6)
  )

# Number of stops per hour over the day
stops_per_hour =
  stop_frisk_df %&gt;% 
  mutate(
    hour_stop = hour(time_stop),
    part_of_day = cut(hour_stop, breaks = c(0, 5, 12, 17, 21, 24), labels = c(&quot;Night&quot;, &quot;Morning&quot;, &quot;Afternoon&quot;, &quot;Evening&quot;, &quot;Night&quot;), right = FALSE),
    part_of_day = fct_relevel(part_of_day, &quot;Morning&quot;, &quot;Afternoon&quot;, &quot;Evening&quot;)
  ) %&gt;% 
  select(hour_stop, part_of_day) %&gt;% 
  group_by(hour_stop, part_of_day) %&gt;% 
  summarize(
    count = n()
  ) %&gt;% 
  ggplot(aes(x = hour_stop, y = count)) + 
  geom_bar(stat = &quot;Identity&quot;, aes(fill = part_of_day)) +
  labs(
    title = &quot;Number of stops per hour over the day&quot;,
    x = &quot;Hour of stop&quot;,
    y = &quot;Number of stops&quot;,
    fill = &quot;Part of day&quot;
  ) +
  theme(
    legend.title = element_text(size = 8),
    legend.text = element_text(size = 6)
  ) +
  scale_fill_viridis_d(direction = -1, option = &quot;magma&quot;)

# Number of stops per day of week 
stops_per_dow = stop_frisk_df %&gt;% 
  mutate(
    dow_stop = wday(date_stop, label = TRUE)
  ) %&gt;% 
  group_by(dow_stop) %&gt;% 
  summarize(
    count = n()
  ) %&gt;% 
  ggplot(aes(x = dow_stop, y = count)) + 
  geom_bar(stat = &quot;Identity&quot;) +
  labs(
    title = &quot;Number of stops per day of week&quot;,
    x = &quot;Day of week&quot;,
    y = &quot;Number of stops&quot;
  ) +
  theme(legend.position = &quot;none&quot;)

(stops_per_day + stops_per_hour) / (stops_per_month + stops_per_dow)</code></pre>
<p><img src="project_report_files/figure-html/unnamed-chunk-18-1.png" width="90%" /></p>
<p>We also conducted analysis to explore the trends in stops over time and by borough in NYC. We discovered that the number of stops steadily decreased through 2016. Also, most boroughs in NYC have a similar trend and number of stops, except for Staten Island, which had a steady smaller number of stops. Additionally, the frequency of stops is less in the morning and higher towards the evening/night. Finally, we looked at the number of stops by the day of the week and discovered that less stops occur on Sunday and Monday than the other days of the week.</p>
</div>
<div id="reasons-for-being-stopped" class="section level3">
<h3>Reasons for Being Stopped</h3>
<pre class="r"><code>reasons = 
  stop_frisk_df %&gt;% 
  select(cs_objcs:cs_lkout, cs_cloth, cs_drgtr, cs_furtv, cs_vcrim:cs_other, frisked) %&gt;% 
  pivot_longer(
    cs_objcs:cs_other,
    names_to = &quot;reason_stopped&quot;,
    values_to = &quot;stops&quot;
  ) %&gt;% 
  mutate(
    reason_stopped = recode(
    reason_stopped,
    &quot;cs_objcs&quot; = &quot;carrying suspicious object&quot;,
    &quot;cs_descr&quot; = &quot;fits a relevant description&quot;,
    &quot;cs_casng&quot; = &quot;casing a victim or location&quot;,
    &quot;cs_lkout&quot; = &quot;suspect acting as a lookout&quot;,
    &quot;cs_cloth&quot; = &quot;wearing clothes commonly used in crimes&quot;,
    &quot;cs_drgtr&quot; = &quot;actions indicative of drug transaction&quot;,
    &quot;cs_furtv&quot; = &quot;furtive movements&quot;,
    &quot;cs_vcrim&quot; = &quot;actions engaging in violent crime&quot;,
    &quot;cs_bulge&quot; = &quot;suspicious bulge&quot;,
    &quot;cs_other&quot; = &quot;other&quot;
  )) %&gt;% 
  filter(stops == 1) %&gt;% 
  group_by(reason_stopped) %&gt;% 
  summarize(total =n()) 
 
plot_ly(x = ~reason_stopped, y= ~total, type = &quot;bar&quot; , color = ~reason_stopped, colors = &quot;Set1&quot;, data = reasons) %&gt;% 
    layout(
    xaxis = list(
      title  = &#39;Reasons Stopped&#39;), 
    yaxis = list(
      title = &#39;Total&#39;))</code></pre>
<div id="htmlwidget-6c28349c4e32b2fb5e7c" style="width:90%;height:576px;" class="plotly html-widget"></div>
<<<<<<< HEAD
<script type="application/json" data-for="htmlwidget-6c28349c4e32b2fb5e7c">{"x":{"visdat":{"9d943b73db4":["function () ","plotlyVisDat"]},"cur_data":"9d943b73db4","attrs":{"9d943b73db4":{"x":{},"y":{},"color":{},"colors":"Set1","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Reasons Stopped","type":"category","categoryorder":"array","categoryarray":["actions engaging in violent crime","actions indicative of drug transaction","carrying suspicious object","casing a victim or location","fits a relevant description","furtive movements","other","suspect acting as a lookout","suspicious bulge","wearing clothes commonly used in crimes"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Total"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["actions engaging in violent crime"],"y":[758],"type":"bar","name":"actions engaging in violent crime","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"textfont":{"color":"rgba(228,26,28,1)"},"error_y":{"color":"rgba(228,26,28,1)"},"error_x":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["actions indicative of drug transaction"],"y":[636],"type":"bar","name":"actions indicative of drug transaction","marker":{"color":"rgba(102,120,166,1)","line":{"color":"rgba(102,120,166,1)"}},"textfont":{"color":"rgba(102,120,166,1)"},"error_y":{"color":"rgba(102,120,166,1)"},"error_x":{"color":"rgba(102,120,166,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["carrying suspicious object"],"y":[365],"type":"bar","name":"carrying suspicious object","marker":{"color":"rgba(83,164,102,1)","line":{"color":"rgba(83,164,102,1)"}},"textfont":{"color":"rgba(83,164,102,1)"},"error_y":{"color":"rgba(83,164,102,1)"},"error_x":{"color":"rgba(83,164,102,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["casing a victim or location"],"y":[1698],"type":"bar","name":"casing a victim or location","marker":{"color":"rgba(139,116,136,1)","line":{"color":"rgba(139,116,136,1)"}},"textfont":{"color":"rgba(139,116,136,1)"},"error_y":{"color":"rgba(139,116,136,1)"},"error_x":{"color":"rgba(139,116,136,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["fits a relevant description"],"y":[5870],"type":"bar","name":"fits a relevant description","marker":{"color":"rgba(216,103,94,1)","line":{"color":"rgba(216,103,94,1)"}},"textfont":{"color":"rgba(216,103,94,1)"},"error_y":{"color":"rgba(216,103,94,1)"},"error_x":{"color":"rgba(216,103,94,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["furtive movements"],"y":[2234],"type":"bar","name":"furtive movements","marker":{"color":"rgba(255,186,23,1)","line":{"color":"rgba(255,186,23,1)"}},"textfont":{"color":"rgba(255,186,23,1)"},"error_y":{"color":"rgba(255,186,23,1)"},"error_x":{"color":"rgba(255,186,23,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["other"],"y":[5378],"type":"bar","name":"other","marker":{"color":"rgba(227,197,50,1)","line":{"color":"rgba(227,197,50,1)"}},"textfont":{"color":"rgba(227,197,50,1)"},"error_y":{"color":"rgba(227,197,50,1)"},"error_x":{"color":"rgba(227,197,50,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["suspect acting as a lookout"],"y":[875],"type":"bar","name":"suspect acting as a lookout","marker":{"color":"rgba(185,95,74,1)","line":{"color":"rgba(185,95,74,1)"}},"textfont":{"color":"rgba(185,95,74,1)"},"error_y":{"color":"rgba(185,95,74,1)"},"error_x":{"color":"rgba(185,95,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["suspicious bulge"],"y":[894],"type":"bar","name":"suspicious bulge","marker":{"color":"rgba(237,133,187,1)","line":{"color":"rgba(237,133,187,1)"}},"textfont":{"color":"rgba(237,133,187,1)"},"error_y":{"color":"rgba(237,133,187,1)"},"error_x":{"color":"rgba(237,133,187,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["wearing clothes commonly used in crimes"],"y":[402],"type":"bar","name":"wearing clothes commonly used in crimes","marker":{"color":"rgba(153,153,153,1)","line":{"color":"rgba(153,153,153,1)"}},"textfont":{"color":"rgba(153,153,153,1)"},"error_y":{"color":"rgba(153,153,153,1)"},"error_x":{"color":"rgba(153,153,153,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
=======
<script type="application/json" data-for="htmlwidget-6c28349c4e32b2fb5e7c">{"x":{"visdat":{"190939b875fc":["function () ","plotlyVisDat"]},"cur_data":"190939b875fc","attrs":{"190939b875fc":{"x":{},"y":{},"color":{},"colors":"Set1","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Reasons Stopped","type":"category","categoryorder":"array","categoryarray":["actions engaging in violent crime","actions indicative of drug transaction","carrying suspicious object","casing a victim or location","fits a relevant description","furtive movements","other","suspect acting as a lookout","suspicious bulge","wearing clothes commonly used in crimes"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Total"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["actions engaging in violent crime"],"y":[758],"type":"bar","name":"actions engaging in violent crime","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"textfont":{"color":"rgba(228,26,28,1)"},"error_y":{"color":"rgba(228,26,28,1)"},"error_x":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["actions indicative of drug transaction"],"y":[636],"type":"bar","name":"actions indicative of drug transaction","marker":{"color":"rgba(101,120,166,1)","line":{"color":"rgba(101,120,166,1)"}},"textfont":{"color":"rgba(101,120,166,1)"},"error_y":{"color":"rgba(101,120,166,1)"},"error_x":{"color":"rgba(101,120,166,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["carrying suspicious object"],"y":[365],"type":"bar","name":"carrying suspicious object","marker":{"color":"rgba(83,164,102,1)","line":{"color":"rgba(83,164,102,1)"}},"textfont":{"color":"rgba(83,164,102,1)"},"error_y":{"color":"rgba(83,164,102,1)"},"error_x":{"color":"rgba(83,164,102,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["casing a victim or location"],"y":[1698],"type":"bar","name":"casing a victim or location","marker":{"color":"rgba(139,116,136,1)","line":{"color":"rgba(139,116,136,1)"}},"textfont":{"color":"rgba(139,116,136,1)"},"error_y":{"color":"rgba(139,116,136,1)"},"error_x":{"color":"rgba(139,116,136,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["fits a relevant description"],"y":[5870],"type":"bar","name":"fits a relevant description","marker":{"color":"rgba(216,103,94,1)","line":{"color":"rgba(216,103,94,1)"}},"textfont":{"color":"rgba(216,103,94,1)"},"error_y":{"color":"rgba(216,103,94,1)"},"error_x":{"color":"rgba(216,103,94,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["furtive movements"],"y":[2234],"type":"bar","name":"furtive movements","marker":{"color":"rgba(255,186,23,1)","line":{"color":"rgba(255,186,23,1)"}},"textfont":{"color":"rgba(255,186,23,1)"},"error_y":{"color":"rgba(255,186,23,1)"},"error_x":{"color":"rgba(255,186,23,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["other"],"y":[5378],"type":"bar","name":"other","marker":{"color":"rgba(227,197,50,1)","line":{"color":"rgba(227,197,50,1)"}},"textfont":{"color":"rgba(227,197,50,1)"},"error_y":{"color":"rgba(227,197,50,1)"},"error_x":{"color":"rgba(227,197,50,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["suspect acting as a lookout"],"y":[875],"type":"bar","name":"suspect acting as a lookout","marker":{"color":"rgba(185,95,74,1)","line":{"color":"rgba(185,95,74,1)"}},"textfont":{"color":"rgba(185,95,74,1)"},"error_y":{"color":"rgba(185,95,74,1)"},"error_x":{"color":"rgba(185,95,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["suspicious bulge"],"y":[894],"type":"bar","name":"suspicious bulge","marker":{"color":"rgba(237,133,187,1)","line":{"color":"rgba(237,133,187,1)"}},"textfont":{"color":"rgba(237,133,187,1)"},"error_y":{"color":"rgba(237,133,187,1)"},"error_x":{"color":"rgba(237,133,187,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["wearing clothes commonly used in crimes"],"y":[402],"type":"bar","name":"wearing clothes commonly used in crimes","marker":{"color":"rgba(153,153,153,1)","line":{"color":"rgba(153,153,153,1)"}},"textfont":{"color":"rgba(153,153,153,1)"},"error_y":{"color":"rgba(153,153,153,1)"},"error_x":{"color":"rgba(153,153,153,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
>>>>>>> 099bf7ed9e2630663e07393b72c0294ef2d00d6c
<pre class="r"><code>fits_desc = reasons%&gt;% 
  filter(reason_stopped == &quot;fits a relevant description&quot;)

other = reasons %&gt;% 
   filter(reason_stopped == &quot;other&quot;)

clothes = 
  reasons %&gt;% 
   filter(reason_stopped == &quot;wearing clothes commonly used in crimes&quot;)
object =
    reasons %&gt;% 
   filter(reason_stopped == &quot;carrying suspicious object&quot;)</code></pre>
<p>We conducted analysis over different reasons why individuals were stopped. There are 10 different categories of reasons which are actions engaging in violent crime, actions indicative of drug transaction, carrying suspicious object, casing a victim or location, fits a relevant description, furtive movements, other, suspect acting as a lookout, suspicious bulge, wearing clothes commonly used in crimes Amongst these different reasons “fits a relevant description” had a total of 5870, falling close behind was <code>other</code> with a total of 5378, and the reasons with the least amount of 402 was <code>wearing clothes commonly used in crimes</code> and the amount of 365 was <code>carrying a suspicious object</code>.</p>
</div>
</div>
<div id="discussion" class="section level1">
<h1>Discussion</h1>
<p>The models created for FRISKED and ARST_MADE were not very successful at predicting who would be frisked or arrested. The logistic models were only slightly more successful at predicting whether or not the person would be frisked or arrested compared to taking a guess. While our goal was to develop a predictive model, this model shows that the given variables are not helpful in determining whether or not the individual will be frisked or arrested. The decision will most likely include other unknown factors that influence the stop that are not able to be recorded. After the tactic came under scrutiny, the NYPD is taking measures to ensure that the policy is non-discriminant. However, as is described under the demographics analysis section, those that are stopped in the first place tend to be non-white race.</p>
<p>Machine learning did not improve our predictive modeling. This may be due to the fact that many of the variables need a greater understanding of the topic before making a decision to remove it from the model or not. For arrest made model, it did not predict any probability of being arrested greater than 0.50. This is due to the fact that only 0.2130764% of individuals from the dataset were arrested. This problem was anticipated to be nullified by splitting the dataset 50/50 to make sure there were enough arrest observations in both the testing and the training dataset, however this was not the case. To create better predictions for the arrest made confusion matrix, we lowered the “positive” probability cut off to be 0.30 instead of 0.50.</p>
<p>Looking at the trends in stop frequency across time raise some interesting questions to be explored in future analysis. For example, why did the number of stops decrease across 2016? Are there policy changes causing the shift? Pushback from the general public? It was unsurprising to find that Staten Island had the least number of stops because they have the smallest population of all five boroughs. Looking at the frequency of stops by day of the week and hour of the day reveal some interesting trends that could be explored further by looking at data to understand when the most crimes are committed or when the NYPD has the most officers on duty.</p>
<p>After thorough analysis of the data, the total count of reasons for being stopped for each category was greater than the dataset. It was discovered that a single stop could contain multiple ‘reasons for stop’. Considering this, our analysis of the different reasons for stop could be misleading. This could explain why the “other” category is among the highest. For future analysis we could look only at people who were stopped for multiple reasons and just look at the people who were stopped for only one reason separately just so we could get a more feasible count of each category of reasons for stop. Our data also had a concerning distribution in age, ranging from 1 to 99 years, and weight, ranging from 1 to 999 pounds. While it is difficult to question the validity of specific entries in the dataset, there were certain extreme entries that we felt confident in removing, for example weight = 999 or age = 1.</p>
<p>Innocent individuals were determined to be those who were not arrested, after being stopped. It was calculated that the percent innocent within each race is approximately equally distributed among the races and is around 80%.</p>
<p>Looking at the distribution of stops, frisks or searches, and arrests by precinct of all NYC, one can see that there is a slight trend where areas with higher amounts of stops and frisks also have higher amounts of arrests. However, when isolating individual boroughs (specifically the Bronx and Brooklyn), one can see that this trend starts to break down. Analyzing the reason for stopping shows that every precinct’s most frequent rationale for stopping is either “fits a relevant description”, or “other” – which is consistent with our analysis of the overall data. Finally, when analyzing which race makes up the greatest percentage of stops in each precinct, a majority of precincts stop either black or white-Hispanic individuals. This is especially surprising considering that in many neighborhoods that do not have a historically high number of people of color, they nevertheless make up a majority of the stops in those general areas (i.e. Financial District, Battery Park, Midtown, Hell’s Kitchen, etc.). This further suggests possible racial profiling in conducting stops by the NYPD.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
